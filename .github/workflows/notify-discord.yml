name: Discord Notify

on:
  workflow_call:
    inputs:
      version:
        description: "SDK version (e.g., 0.2.0)"
        required: true
        type: string
      browser_url:
        description: "Browser demo URL"
        required: false
        type: string

jobs:
  notify:
    name: Discord Notify
    runs-on: ubuntu-latest
    steps:
      - name: Notify Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          VERSION: ${{ inputs.version }}
          BROWSER_URL: ${{ inputs.browser_url }}
        run: |
          curl -X POST "$DISCORD_WEBHOOK" \
            -H "Content-Type: application/json" \
            -d @- << EOF
          {
            "embeds": [{
              "title": "VultisigSDK v${VERSION} Released!",
              "color": 5814783,
              "description": "A new version of VultisigSDK has been published to npm.",
              "fields": [
                {
                  "name": "Packages",
                  "value": "[@vultisig/sdk](https://www.npmjs.com/package/@vultisig/sdk)\n[@vultisig/cli](https://www.npmjs.com/package/@vultisig/cli)",
                  "inline": true
                },
                {
                  "name": "Version",
                  "value": "v${VERSION}",
                  "inline": true
                },
                {
                  "name": "Installation",
                  "value": "\`\`\`bash\nnpm install @vultisig/sdk@${VERSION}\n\`\`\`"
                },
                {
                  "name": "Links",
                  "value": "[Documentation](https://docs.vultisig.com/developer-docs/vultisig-sdk) | [Browser Demo](${BROWSER_URL:-https://browser-six-sandy.vercel.app/}) | [Changelog](https://github.com/vultisig/vultisig-sdk/releases) | [GitHub](https://github.com/vultisig/vultisig-sdk)"
                }
              ],
              "footer": {
                "text": "VultisigSDK - Multi-party computation wallet SDK"
              }
            }]
          }
          EOF
